<!DOCTYPE html><html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estrazione Automatica da PDF</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin-top: 10px; padding: 8px; width: 100%; }
    label { margin-top: 15px; display: block; }
  </style>
</head>
<body>
  <h2>Carica PDF Allenamento</h2>
  <input type="file" id="file-pdf" accept="application/pdf"><label>Durata</label> <input type="text" id="durata" placeholder="00:00:00">

<label>KCAL</label> <input type="text" id="kcal" placeholder="000">

<label>Battito Medio</label> <input type="text" id="bpm" placeholder="000">

  <script>
    document.getElementById('file-pdf').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const fileReader = new FileReader();
      fileReader.onload = async function() {
        const typedarray = new Uint8Array(this.result);

        const pdf = await pdfjsLib.getDocument(typedarray).promise;
        const page = await pdf.getPage(1);
        const textContent = await page.getTextContent();

        let fullText = textContent.items.map(item => item.str).join(' ');
        console.log(fullText);

        // Estrai i dati con regex
        const durata = fullText.match(/Durata[:\s]*(\d{2}:\d{2}:\d{2})/i);
        const kcal = fullText.match(/KCAL[:\s]*(\d+)/i);
        const bpm = fullText.match(/Battito Medio[:\s]*(\d+)/i);

        if (durata) document.getElementById('durata').value = durata[1];
        if (kcal) document.getElementById('kcal').value = kcal[1];
        if (bpm) document.getElementById('bpm').value = bpm[1];
      };

      fileReader.readAsArrayBuffer(file);
    });
  </script></body>
</html>
